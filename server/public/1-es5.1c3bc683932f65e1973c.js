function _createForOfIteratorHelper(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,r=_getPrototypeOf(e);if(t){var i=_getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{EdD2:function(e,t,n){"use strict";n.r(t);var r,i=n("ofXK"),a=n("fXoL"),o=n("tyNb"),s=n("WnqB"),c=n("pfAz"),l=n("tk/3"),u=n("vFID"),f=((r=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){return _classCallCheck(this,n),t.call(this,e,r)}return _createClass(n,[{key:"list",value:function(){return this.get("chat/list",{}).then((function(e){return console.log("ChatDataService -> list -> response",e),Promise.resolve(e)})).catch((function(e){return console.log("ChatDataService -> list -> err",{err:e}),Promise.reject([])}))}},{key:"listChannels",value:function(){return this.get("chat/channels",{}).then((function(e){return console.log("ChatDataService -> list -> response",e),Promise.resolve(e)})).catch((function(e){return console.log("ChatDataService -> list -> err",{err:e}),Promise.reject([])}))}},{key:"getChannel",value:function(e){return this.get("chat/get/".concat(e),{}).then((function(e){return Promise.resolve(e)})).catch((function(e){return console.log("ChatDataService -> getChat -> err",{err:e}),Promise.reject([])}))}},{key:"getChat",value:function(e){return this.get("chat/with/".concat(e),{}).then((function(e){return Promise.resolve(e)})).catch((function(e){return console.log("ChatDataService -> getChat -> err",{err:e}),Promise.reject([])}))}},{key:"messagesFromChat",value:function(e){return this.get("chat/".concat(e.id,"/messages"),{}).then((function(e){return Promise.resolve(e)})).catch((function(e){return console.log("ChatDataService -> messagesFromChat -> err",{err:e}),Promise.reject([])}))}},{key:"newMessage",value:function(e,t){var n=Object.assign(Object.assign({},t),{date:Date.now()});return this.post("chat/".concat(e,"/message"),{message:n}).then((function(e){return Promise.resolve(e)})).catch((function(e){return console.log("newMessage -> err",e),Promise.reject()}))}},{key:"update",value:function(e){var t=e.id,n=e.name,r=e.nicknames;return this.post("chat/update/".concat(t),{name:n,nicknames:r}).then((function(e){return Promise.resolve(e)})).catch((function(e){return console.log("ChatDataService -> update -> err",{err:e}),Promise.reject([])}))}},{key:"joinToChat",value:function(e,t){var n=e.id,r=e.nicknames;return this.update({id:n,nicknames:[].concat(_toConsumableArray(r),[t])})}}]),n}(c.a)).\u0275fac=function(e){return new(e||r)(a.Rb(l.a),a.Rb(u.a))},r.\u0275prov=a.Fb({token:r,factory:r.\u0275fac,providedIn:"root"}),r);function h(e,t){if(1&e&&(a.Nb(0,"div",3),a.kc(1),a.Mb()),2&e){var n=a.Xb();a.zb(1),a.lc(n.text)}}function b(e,t){if(1&e&&(a.Nb(0,"div",4),a.kc(1),a.Mb()),2&e){var n=a.Xb();a.zb(1),a.lc(n.text)}}function m(e,t){1&e&&a.Lb(0)}function p(e,t){if(1&e&&a.ic(0,m,1,0,"ng-container",5),2&e){a.Xb();var n=a.ec(1);a.ac("ngTemplateOutlet",n)}}var d,g,v=((g=function(){function e(){_classCallCheck(this,e),this.text="",this.notMine=!0}return _createClass(e,[{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||g)},g.\u0275cmp=a.Db({type:g,selectors:[["chat-message"]],inputs:{text:"text",notMine:"notMine"},decls:5,vars:2,consts:[["messageTpl",""],["myMessageTpl",""],[3,"ngIf","ngIfElse"],[1,"inline-block","whitespace-pre-wrap","my-1","px-2","py-1","bg-gray-200","rounded-md","text-gray-800","leading-tight","sm:max-w-md"],[1,"inline-block","whitespace-pre-wrap","my-1","px-2","py-1","bg-green-200","rounded-md","text-gray-800","leading-tight","text-right","sm:max-w-md"],[4,"ngTemplateOutlet"]],template:function(e,t){if(1&e&&(a.ic(0,h,2,1,"ng-template",null,0,a.jc),a.ic(2,b,2,1,"ng-template",null,1,a.jc),a.ic(4,p,1,1,"ng-template",2)),2&e){var n=a.ec(3);a.zb(4),a.ac("ngIf",t.notMine)("ngIfElse",n)}},directives:[i.j,i.k],encapsulation:2}),g),y=((d=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"transform",value:function(e,t){var n=t.prop,r=t.sep;return n||(n="name"),r||(r="|"),e.map((function(e){return e[n]})).join(r)}}]),e}()).\u0275fac=function(e){return new(e||d)},d.\u0275pipe=a.Ib({name:"map_join",type:d,pure:!0}),d),k=["lastDiv"];function C(e,t){if(1&e&&(a.Nb(0,"div",3),a.Kb(1,"img",4),a.Nb(2,"div"),a.Nb(3,"h2",5),a.kc(4),a.Mb(),a.Nb(5,"div",6),a.kc(6),a.Mb(),a.Mb(),a.Mb()),2&e){var n=a.Xb();a.zb(1),a.ac("src",n.chat.participants[1].image,a.gc),a.zb(3),a.lc(n.chat.participants[1].fullName),a.zb(2),a.mc("@",n.chat.participants[1].nickname,"")}}var w=function(){return{prop:"nickname",sep:", "}};function M(e,t){if(1&e&&(a.Nb(0,"div",7),a.Nb(1,"div"),a.Nb(2,"div",8),a.kc(3),a.Mb(),a.Nb(4,"div",9),a.Nb(5,"div",10),a.kc(6),a.Mb(),a.Nb(7,"div",11),a.kc(8),a.Yb(9,"map_join"),a.Mb(),a.Mb(),a.Mb(),a.Mb()),2&e){var n=a.Xb();a.zb(3),a.mc("#",n.chat.name,""),a.zb(3),a.lc(n.chat.participants.length),a.zb(2),a.lc(a.Zb(9,3,n.chat.participants,a.bc(6,w)))}}function _(e,t){1&e&&a.Lb(0)}function x(e,t){if(1&e&&a.ic(0,_,1,0,"ng-container",24),2&e){a.Xb(2);var n=a.ec(3);a.ac("ngTemplateOutlet",n)}}function S(e,t){if(1&e&&a.Kb(0,"img",32),2&e){var n=a.Xb().$implicit,r=a.Xb(2);a.ac("src",r.chat.user[n.from].image,a.gc)}}var j=function(e){return{"justify-end":e}};function N(e,t){if(1&e&&(a.Nb(0,"div",33),a.Kb(1,"chat-message",34),a.Mb()),2&e){var n=t.$implicit,r=a.Xb().$implicit,i=a.Xb(2);a.ac("ngClass",a.cc(3,j,r.from===i.me.id)),a.zb(1),a.ac("notMine",r.from!==i.me.id)("text",n.text)}}var O=function(e){return{"w-16":e}};function P(e,t){if(1&e&&(a.Nb(0,"div",25),a.Nb(1,"div",9),a.Nb(2,"div",26),a.ic(3,S,1,1,"img",27),a.Mb(),a.Nb(4,"div",19),a.Nb(5,"div",28),a.Nb(6,"div",29),a.kc(7),a.Mb(),a.Mb(),a.Nb(8,"div",30),a.ic(9,N,2,5,"div",31),a.Mb(),a.Mb(),a.Mb(),a.Mb()),2&e){var n=t.$implicit,r=a.Xb(2);a.zb(2),a.ac("ngClass",a.cc(5,O,n.from===r.me.id)),a.zb(1),a.ac("ngIf",r.chat.isChannel&&n.from!==r.me.id),a.zb(2),a.ac("ngClass",a.cc(7,j,n.from===r.me.id)),a.zb(2),a.lc(r.chat.user[n.from].fullName),a.zb(2),a.ac("ngForOf",n.messages)}}function I(e,t){if(1&e){var n=a.Ob();a.Nb(0,"div",12),a.Nb(1,"div",13),a.Nb(2,"div",14),a.ic(3,x,1,1,"ng-template",15),a.Nb(4,"div",16),a.Nb(5,"div",17),a.Nb(6,"div",18),a.Nb(7,"div",19),a.ic(8,P,10,9,"div",20),a.Mb(),a.Mb(),a.Mb(),a.Nb(9,"div",21,22),a.Nb(11,"textarea",23),a.Vb("keyup.enter",(function(e){return a.fc(n),a.Xb().newMessage(e.target)}))("input",(function(e){return a.fc(n),a.Xb().typing=e.target.value})),a.Mb(),a.Mb(),a.Mb(),a.Mb(),a.Mb(),a.Mb()}if(2&e){var r=a.Xb(),i=a.ec(1);a.zb(3),a.ac("ngIf",r.chat.isChannel)("ngIfElse",i),a.zb(5),a.ac("ngForOf",r.chat.messages.blocks),a.zb(3),a.ac("value",r.typing)("disabled",r.isSendingMessage)}}var z=function(e){return["/chat/channel",e]};function T(e,t){if(1&e&&(a.Nb(0,"li",39),a.Nb(1,"h2",40),a.kc(2),a.Mb(),a.Nb(3,"div",41),a.kc(4),a.Yb(5,"map_join"),a.Mb(),a.Mb()),2&e){var n=t.$implicit;a.ac("routerLink",a.cc(7,z,n.id)),a.zb(2),a.nc("",n.isChannel?"#":"","",n.name,""),a.zb(2),a.mc("with: ",a.Zb(5,4,n.participants,a.bc(9,w)),"")}}function D(e,t){if(1&e){var n=a.Ob();a.Nb(0,"div",12),a.Nb(1,"div",13),a.Nb(2,"div",14),a.Nb(3,"div",35),a.Nb(4,"div",5),a.kc(5,"chats"),a.Mb(),a.Nb(6,"input",36),a.Vb("input",(function(e){return a.fc(n),a.Xb().filterInput(e.target.value)})),a.Mb(),a.Mb(),a.Nb(7,"div",16),a.Nb(8,"div",17),a.Nb(9,"div",18),a.Nb(10,"div",19),a.Nb(11,"div",25),a.Nb(12,"ul",37),a.ic(13,T,6,10,"li",38),a.Mb(),a.Mb(),a.Mb(),a.Mb(),a.Mb(),a.Mb(),a.Mb(),a.Mb(),a.Mb()}if(2&e){var r=a.Xb();a.zb(13),a.ac("ngForOf",r.filteredData)}}var B,A,E=((B=function(){function e(t,n,r,i){_classCallCheck(this,e),this.route=t,this.chatSocketEvt=n,this.chatPersistenceService=r,this.typing="",this.isSendingMessage=!1,this.me=i.get("user")}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.clearData(),this.paramSubscriber=this.route.params.subscribe((function(t){var n=t.nickname;if(n)return e.queryChat(n);var r=t.channelId;if(r)switch(r){case"all":return e.dataChat=null,e.chatPersistenceService.listChannels().then((function(t){e.data=t.chatList}));default:return e.data=null,e.queryGroup(r)}return e.chatPersistenceService.list().then((function(t){e.data=t.chatList}))}))}},{key:"clearData",value:function(){this.dataSource=null,this.filter=null,this.filteredData=null,this.chat=null}},{key:"queryGroup",value:function(e){this.chatPersistenceService.getChannel(e).then(this.loadChat.bind(this))}},{key:"queryChat",value:function(e){this.chatPersistenceService.getChat(e).then(this.loadChat.bind(this))}},{key:"loadChat",value:function(e){var t=this,n=e.chat;this.chatPersistenceService.messagesFromChat(n).then((function(e){var r=(e.messageList||[]).reduce((function(e,t){return e.firstBlock?(e.firstBlock.from===t.from?e.firstBlock.messages=[t].concat(_toConsumableArray(e.firstBlock.messages)):(e.firstBlock={from:t.from,messages:[t]},e.blocks=[e.firstBlock].concat(_toConsumableArray(e.blocks))),e):(e.firstBlock={from:t.from,messages:[t]},e.lastBlock=e.firstBlock,e.blocks=[e.firstBlock],e)}),{lastBlock:null,firstBlock:null,blocks:[]});t.dataChat=Object.assign(Object.assign({},n),{messages:r}),t.joinMessages(t.chat)}))}},{key:"filterInput",value:function(e){console.log("filterInput -> str",e),this.query(e?{name:e}:null)}},{key:"query",value:function(e){if(!e)return this.filteredData=this.dataSource;this.filteredData=this.dataSource.filter((function(t){for(var n in e)if(e.hasOwnProperty(n)){var r=t[n];if("string"==typeof r&&r.toLowerCase().indexOf(e[n].toLowerCase())>=0)return t;if(r===e[n])return t}return null}))}},{key:"joinMessages",value:function(e){e.messages=e.messages||{};var t,n=_createForOfIteratorHelper(e.newMessages||[]);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.isOld||(r.isOld=!0,e.messages.lastBlock||(e.messages.firstBlock={from:r.from,messages:[r]},e.messages.lastBlock=e.messages.firstBlock,e.messages.blocks=[e.messages.firstBlock]),e.messages.lastBlock.from===r.from?e.messages.lastBlock.messages.push(r):(e.messages.lastBlock={from:r.from,messages:[r]},e.messages.blocks.push(e.messages.lastBlock)))}}catch(i){n.e(i)}finally{n.f()}this.scrollBottom()}},{key:"ngAfterViewInit",value:function(){this.scrollBottom()}},{key:"scrollBottom",value:function(){var e=this;setTimeout((function(){try{console.log("--------bottom",e.lastDiv.nativeElement.offsetTop),window.scroll({top:e.lastDiv.nativeElement.offsetTop,behavior:"smooth"})}catch(t){e.scrollBottom()}}),300)}},{key:"newMessage",value:function(e){var t=this;this.isSendingMessage=!0,this.chatPersistenceService.newMessage(this.chat.id,{from:this.me.id,text:this.typing}).then((function(n){t.typing="",t.isSendingMessage=!1,setTimeout((function(){e.focus()}),1)})).catch((function(e){console.log("ChatComponent -> newMessage -> err",e),t.typing="",t.isSendingMessage=!1}))}},{key:"ngOnDestroy",value:function(){this.paramSubscriber.unsubscribe(),this.chatSocketEvt.unsubscribe()}},{key:"data",set:function(e){var t=this;this.dataSource=e,e&&e.length>0&&(this.chatSocketEvt.joinToChatRooms(this.dataSource,this.me.id),this.dataSource.forEach((function(e){t.chatSocketEvt.onChatMessage(e,t.joinMessages.bind(t))}))),this.filterInput(this.filter)}},{key:"dataChat",set:function(e){var t=this;this.chat=e,e&&(this.chat.user=this.chat.participants.reduce((function(e,t){return e[t.id]=t,e}),{}),this.chatSocketEvt.joinToChatRooms([this.chat],this.me.id),this.chatSocketEvt.onChatMessage(this.chat,(function(e){t.joinMessages(e)}).bind(this)))}}]),e}()).\u0275fac=function(e){return new(e||B)(a.Jb(o.a),a.Jb(s.a),a.Jb(f),a.Jb(u.a))},B.\u0275cmp=a.Db({type:B,selectors:[["app-chat"]],viewQuery:function(e,t){var n;1&e&&a.oc(k,!0),2&e&&a.dc(n=a.Wb())&&(t.lastDiv=n.first)},decls:6,vars:2,consts:[["directMessageProfile",""],["groupProfile",""],["class","h-full text-gray-900",4,"ngIf"],[1,"p-4","flex","items-center","shadow","sticky","top-0","bg-white"],[1,"w-10","h-10","md:h-16","md:w-16","rounded-full","mr-2",3,"src"],[1,"font-medium","leading-none","capitalize"],[1,"text-gray-600","text-xs","leading-none"],[1,"p-4","flex","justify-between","items-end","shadow","sticky","top-0","bg-white"],[1,"font-medium"],[1,"flex"],[1,"text-sm","text-gray-700","font-normal","px-2","border-r-2"],[1,"text-sm","text-gray-700","font-normal","px-2"],[1,"h-full","text-gray-900"],[1,"h-full"],[1,"h-full","flex","flex-col"],[3,"ngIf","ngIfElse"],[1,"flex-1","flex","flex-col"],[1,"px-4","flex-1"],[1,"flex","flex-col"],[1,"flex-1"],["class","my-2",4,"ngFor","ngForOf"],[1,"bg-white","px-3","sticky","inset-0","mt-2"],["lastDiv",""],["name","chatting-area","placeholder","Type your message here",1,"w-full","p-2","text-sm","text-gray-800","rounded-md","border","resize-none","focus:outline-none","focus:shadow",3,"value","disabled","keyup.enter","input"],[4,"ngTemplateOutlet"],[1,"my-2"],[1,"mr-3","w-16",3,"ngClass"],["class","w-10 h-10 md:h-16 md:w-16 object-cover rounded-full",3,"src",4,"ngIf"],[1,"ml-1","flex","items-end","justify-end",3,"ngClass"],[1,"font-medium","mr-2","leading-none","capitalize"],[1,"text-sm"],["class","flex justify-end",3,"ngClass",4,"ngFor","ngForOf"],[1,"w-10","h-10","md:h-16","md:w-16","object-cover","rounded-full",3,"src"],[1,"flex","justify-end",3,"ngClass"],[3,"notMine","text"],[1,"p-4"],["name","filter","placeholder","Search by chat name or nickname","type","search",1,"w-full","p-2","mt-2","text-lg","text-gray-800","rounded-md","border","resize-none","focus:outline-none","focus:shadow",3,"input"],[1,""],["class","p-1 bg-white m-1 rounded cursor-pointer shadow",3,"routerLink",4,"ngFor","ngForOf"],[1,"p-1","bg-white","m-1","rounded","cursor-pointer","shadow",3,"routerLink"],[1,"text-lg"],[1,"text-sm","text-gray-500"]],template:function(e,t){1&e&&(a.ic(0,C,7,3,"ng-template",null,0,a.jc),a.ic(2,M,10,7,"ng-template",null,1,a.jc),a.ic(4,I,12,5,"div",2),a.ic(5,D,14,1,"div",2)),2&e&&(a.zb(4),a.ac("ngIf",t.chat),a.zb(1),a.ac("ngIf",t.dataSource))},directives:[i.j,i.i,i.k,i.h,v,o.c],pipes:[y],encapsulation:2}),B),X=[{path:"",component:E},{path:"with/:nickname",component:E},{path:"channel/:channelId",component:E}],F=((A=function e(){_classCallCheck(this,e)}).\u0275mod=a.Hb({type:A}),A.\u0275inj=a.Gb({factory:function(e){return new(e||A)},imports:[[o.e.forChild(X)],o.e]}),A),L=n("aYsj");n.d(t,"ChatModule",(function(){return q}));var R,q=((R=function e(){_classCallCheck(this,e)}).\u0275mod=a.Hb({type:R}),R.\u0275inj=a.Gb({factory:function(e){return new(e||R)},imports:[[i.b,F,L.a]]}),R)}}]);